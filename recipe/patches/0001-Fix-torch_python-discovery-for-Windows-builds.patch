From c35076f938e00672a5e2beb452b9773d832572bc Mon Sep 17 00:00:00 2001
From: Jeongseok Lee <jeongseok@meta.com>
Date: Fri, 31 Oct 2025 15:16:49 -0700
Subject: [PATCH] Fix torch_python discovery for Windows builds

---
 pymomentum/CMakeLists.txt | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/pymomentum/CMakeLists.txt b/pymomentum/CMakeLists.txt
index 3ef09f200..17918ad43 100644
--- a/pymomentum/CMakeLists.txt
+++ b/pymomentum/CMakeLists.txt
@@ -14,13 +14,13 @@ if(NOT DEFINED ENV{CONDA_PREFIX})
   )
 endif()

-# For PyPI builds (pip wheel), look in site-packages
-# For conda builds, look in CONDA_PREFIX
-if(DEFINED ENV{CONDA_BUILD})
-  # Conda build - use CONDA_PREFIX
+# Determine torch base path based on build environment and platform
+# Use CONDA_PREFIX for Unix conda-build, use site-packages for PyPI or Windows
+if(DEFINED ENV{CONDA_BUILD} AND NOT WIN32)
+  # Unix conda-build - use CONDA_PREFIX
   set(libtorch_base_path $ENV{CONDA_PREFIX})
 else()
-  # PyPI build (pip wheel) - use site-packages/torch
+  # Windows or PyPI - use site-packages/torch
   set(libtorch_base_path ${Python3_SITELIB}/torch)
 endif()

--
2.44.0.windows.1
